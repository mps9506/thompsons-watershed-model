[["index.html", "Empirical Streamflow Predictions at Thompsons Creek About Introduction Method Results References", " Empirical Streamflow Predictions at Thompsons Creek 2021-03-26 ##note, need development version of bookdown and gt to properly compile this document ## readr imports data library(readr) library(tidyr) ## tibbles are advanced fancy dataframes library(tibble) ## dplyr for data handling and piping functions library(dplyr) ## ggplot for plots library(ggplot2) ## stringr to read and manipulate strings library(stringr) ## here is a function to ensure file paths are correct library(here) ## units and ggforce facilitate attaching units to data library(units) library(ggforce) ## hrbrtheme is optional, I use it to pretty my plots library(hrbrthemes) ## patchwork and cowplot support arranging multiple ggplots into one plot library(patchwork) library(cowplot) ## lubridate provides functions for handling time and date library(lubridate) ## purrr lets us use map_ functions as an alternative to loops library(purrr) ## hydroGOF provide goodness of fit metrics (NSE, RMSE, etc.) library(hydroGOF) ## tsibble and imputeTS will allow some simple time series interpolation library(tsibble) library(imputeTS) ## gt library(gtsummary) library(flextable) ## nls.multstart fits non-linear least squares using the Levenberg-Marquardt algorithm with multiple starting values. library(nls.multstart) ## library(mgcv) library(gratia) ## apply drainage area ratio library(dartx) ## set some options update_geom_font_defaults(font_rc) units_options(parse = FALSE) ## some custom functions theme_ms &lt;- function(...) { theme_ipsum_rc(plot_margin = margin(10,10,10,10), axis_title_just = &quot;c&quot;) + theme(legend.position = &quot;bottom&quot;, panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA), panel.border = element_rect(fill = NA, colour = &quot;grey20&quot;), ...) } exponent &lt;- function(x, pow) { (abs(x)^pow)*sign(x) } About This is an exploratory document investigating the feasibility of estimating mean daily streamflows in the Thompsons Creek watershed using empirical methods. In a previous document mean daily streamflows at three sites in the watershed were developed for March 2020 through March 20221 using measured flows, depths, and rating curves. The one-year record of streamflows will be used to fit and validate drainage area ratio, regression, and semi-parametric regression based methods for estimating streamflow using locally available data. Introduction Ungaged streamflow estimation Statistical information transfer methods Statistical information transfer and empirical regression are two relatively simple methods for estimating streamflows in poorly gaged watersheds using only measured stremaflow values from nearby gaged watersheds. Statistical transfer procedures simply transfer flow duration curves or daily streamflow values from a gaged watershed to the ungaged watershed using assumed relationships between area and runoff. The most common statistical transfer method is the drainage area ratio. With the drainage area ratio, daily streamflows are transferred from one basin to the other by multiplying the area ratio to daily streamflows: \\[\\begin{equation} Q_y^t = Q_x^t\\bigg(\\frac{A_y}{A_x}\\bigg)^\\phi \\tag{1} \\end{equation}\\] Where \\(Q_y^t\\) is streamflow at ungaged basin \\(y\\) and time \\(t\\), \\(Q_x^t\\) is streamflow at gaged basin \\(x\\) and time \\(t\\), and \\(\\frac{A_y}{A_x}\\) is the area ratio of the basins. Parameter \\(\\phi\\) is typically equal to one (Asquith, Roussel, and Vrabel 2006). However, Asquith, Roussel, and Vrabel (2006) provides empirically estimated values of \\(\\phi\\) for use in the drainage area ratio when applied in Texas. With an available short term streamflow record available, various stream gages can be assessed for performance using the drainage area ratio method. However, when that short-term streamflow record is available we extend the simple drainage area ratio to a linear regression for streamflow estimation using one or more gaged watersheds: \\[\\begin{equation} Q_y = \\beta_0 + \\beta_n{Q_{xn}} + \\varepsilon \\tag{2} \\end{equation}\\] where \\(Q_y\\) is the predicted mean daily streamflow at the ungaged or temporarily gaged site, \\(\\beta_0\\) is the intercept, \\(Q_{xn}\\) are mean daily streamflows at gaged watershed \\(n\\), \\(\\beta_n\\) is the regression coefficient, and \\(varepsilon\\) is the residual error term assumed normally distributed around mean zero. A linear regression of this form still acts as a streamflow transfer methods like the drainage area approach but allows for an easy incorporation of additional model terms such as lagged streamflows which might improve predictive performance. Semi-parametric rainfall-runoff regression If nearby gaged watersheds are unavailable or are not reflective of the streamflow responses in the ungaged watershed, locally available weather information can be used to empircally estimate streamflow response. A number of empirically based rainfall-runoff routing models are available that account for soil and land-use conditions to predict streamflow response (SIMHYD, IHACRES, and Sacramento rainfall-runoff models are examples). More complex mechanistic models that simulate hydrologic and water quality responses to landuse and precipitation are also available (SWAT and HSPF are two examples). The mechanistic models have a steep requirement for data and ability of the technician developing the model. The routing models and mechanistic models are outside the scope of work for this particular project. Here we focus on using a semi-parametric regression based approach to predict streamflow using locally available weather data. Empirical regression based approaches require a period of measured streamflow and some predictor variables to estimate the runoff response from. Typically, daily rainfall and temperature data are employed to fit a regression model to measured streamflow response: \\[\\begin{equation} Q_i = \\beta_0 + \\beta_1x_i+ \\varepsilon_i \\tag{3} \\end{equation}\\] where \\(Q\\) is predicted discharge on day \\(i\\), \\(\\beta_0\\) is the intercept, \\(\\beta_1\\) is the regression coefficient, \\(x\\) is the predictor variable value on the \\(i\\)th day. The error term, \\(\\varepsilon_i\\) is assumed normally distributed around mean zero. Using simple linear or multiple linear regression \\(Q\\) is typically log transformed prior to estimating the regression coefficients. Generalized linear models (GLMs) can instead be used when the data distribution is skewed (more specifically, when the residuals are not expected to be normally distributed). This is accomplished through the inclusion of a link function that describes how the mean of the response depends on the linear predictor and a variance function the describes how variance depends on the mean. Using the GLM and appropriate link function, transformation of the response variable can be avoided. This approach is highly desirable due to biases in the variance structure that are introduced when estimating the means of log transformed data that is intended to be back transformed to the original scale. If the relationship between predictor variables and the response are expected to be nonlinear, polynomial terms can be included. However, an extension of GLMs called generalized additive models (GAMs) allows relatively easy fitting of these nonlinear terms to the data. With GAMs, the response variable depends on the sum of smoothing functions applied to each predictor variable: \\[\\begin{equation} Q_i = \\beta_0 + f(x_1) + \\varepsilon \\tag{4} \\end{equation}\\] where \\(Q\\) is predicted discharge on day \\(i\\), \\(\\beta_0\\) is the intercept, and some function \\(f(x_1)\\) is the linear predictor. In the case of GAMs fit using the mgcv package in R, \\(f\\) is a smoothing function fit to the data using generalized cross validation or restricted maximum likelihood. Due to the smoothing function and link functions, GAMs are extremely flexible for fitting regression models to data of different distributions and responses. However, compared to linear regression and GLMs the inclusion of the smoothing functions limits interpretability because traditional regression coefficients are not part of the model structure. Therefore, the effect of each individual smoothing function on the response variable mean is shown graphically. Method Data Two National Oceanic and Atmospheric Administration (NOAA) Global Historical Climatology Network (GHCN) locations provide daily precipitation data for the project area (Figure 1; Figure 2). GHCND daily summaries were downloaded for GHCND:USW00003904 (Easterwood Airport) using the NOAA API services and the rnoaa package in R (Chamberlain 2019). easterwood_precip &lt;- read_csv(&quot;Data/noaa_precip/easterwood_precip.csv&quot;, col_types = cols( date = col_datetime(format = &quot;&quot;), datatype = col_character(), station = col_character(), value = col_double(), fl_m = col_character(), fl_q = col_character(), fl_so = col_character(), fl_t = col_character(), units = col_character())) %&gt;% mutate(value = set_units(value/10, &quot;mm&quot;)) %&gt;% select(date, datatype, station, value) easterwood_precip %&gt;% mutate(date = as.Date(date), value = as.numeric(value)) %&gt;% ggplot() + geom_line(aes(date, value)) + geom_point(aes(date, value), alpha = 0) + labs(y = &quot;Daily precipitation (mm)&quot;, x = &quot;Date&quot;) + facet_wrap(~station, ncol = 1) + theme_ms(plot.margin = margin(10,0,10,10), panel.spacing = unit(0, &quot;lines&quot;), panel.spacing.x = unit(0, &quot;lines&quot;), panel.spacing.y = unit(2, &quot;lines&quot;)) -&gt; p1 easterwood_precip %&gt;% mutate(date = as.Date(date), value = as.numeric(value)) %&gt;% ggplot() + geom_histogram(aes(value), binwidth = 5) + facet_wrap(~station, ncol = 1) + coord_flip() + theme_ms() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank(), plot.background = element_blank(), plot.margin = margin(10,10,10,0), panel.spacing = unit(0, &quot;lines&quot;), panel.spacing.x = unit(0, &quot;lines&quot;), panel.spacing.y = unit(2, &quot;lines&quot;), strip.text = element_text(color=&quot;transparent&quot;)) -&gt; p2 plot_grid(p1,p2,align = &quot;h&quot;, axis = &quot;bt&quot;, rel_widths = c(2, 1)) Figure 1: Daily precipitation and marginal histograms of daily precipitation. easterwood_tmax &lt;- read_csv(&quot;Data/noaa_precip/easterwood_tmax.csv&quot;, col_types = cols( date = col_datetime(format = &quot;&quot;), datatype = col_character(), station = col_character(), value = col_double(), fl_m = col_character(), fl_q = col_character(), fl_so = col_character(), fl_t = col_character(), units = col_character())) %&gt;% mutate(value = set_units(value/10, &quot;°C&quot;)) %&gt;% select(date, datatype, station, value) easterwood_tavg &lt;- read_csv(&quot;Data/noaa_precip/easterwood_tavg.csv&quot;, col_types = cols( date = col_datetime(format = &quot;&quot;), datatype = col_character(), station = col_character(), value = col_double(), fl_m = col_character(), fl_q = col_character(), fl_so = col_character(), fl_t = col_character(), units = col_character())) %&gt;% mutate(value = set_units(value/10, &quot;°C&quot;)) %&gt;% select(date, datatype, station, value) easterwood_tmax %&gt;% mutate(date = as.Date(date), value = as.numeric(value)) %&gt;% dplyr::rename(tmax = value) %&gt;% left_join(easterwood_tavg %&gt;% mutate(date = as.Date(date), value = as.numeric(value)) %&gt;% dplyr::rename(tavg = value), by = c(&quot;date&quot;=&quot;date&quot;)) -&gt; easterwood_temps easterwood_temps %&gt;% pivot_longer(c(tmax, tavg), names_to = &quot;stat&quot;, values_to = &quot;value&quot;) %&gt;% ggplot() + geom_step(aes(date, value, color = stat), alpha = 0.5) + labs(y = &quot;Daily Max Temperature [°C]&quot;, x = &quot;Date&quot;) + theme_ms(plot.margin = margin(10,0,10,10), panel.spacing = unit(0, &quot;lines&quot;), panel.spacing.x = unit(0, &quot;lines&quot;), panel.spacing.y = unit(2, &quot;lines&quot;)) -&gt; p1 easterwood_temps %&gt;% pivot_longer(c(tmax, tavg), names_to = &quot;stat&quot;, values_to = &quot;value&quot;) %&gt;% ggplot() + geom_density(aes(value, fill = stat, color = stat), binwidth = 1.1, alpha = 0.5) + coord_flip() + theme_ms() + theme(axis.title.x = element_blank(), axis.title.y = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank(), panel.background = element_blank(), panel.border = element_blank(), panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank(), plot.background = element_blank(), plot.margin = margin(10,10,10,0), panel.spacing = unit(0, &quot;lines&quot;), panel.spacing.x = unit(0, &quot;lines&quot;), panel.spacing.y = unit(2, &quot;lines&quot;), strip.text = element_text(color=&quot;transparent&quot;)) -&gt; p2 plot_grid(p1,p2,align = &quot;h&quot;, axis = &quot;bt&quot;, rel_widths = c(2, 1)) Figure 2: Daily maximum temperature and marginal histograms of daily maximum temperature. We identified two wastewater treatment facilities located upstream of the lowest discharge point. The Still Creek WWTF (TPDES Permit No. WQ0010426002) is permitted to discharge 4.0 MGD to Still Creek and discharge flows past SWQM sites 16882 and 16396. The Sanderson Farm Inc. facility (TPDES Permit No. WQ0003821000) is permitted to discharge 1.678 MGD to a tributary of Cottonwood Branch and the discharge flows past SWQM site 16396. Mean daily wastewater facility discharges were downloaded from the EPA ECHO database (Figure 3) using the echor R package and subtracted from the measured mean daily streamflows to better represent naturalized mean daily flows (Schramm 2020). wwtf &lt;- read_csv(&quot;Data/EPA_WWTF/mean_daily_discharges.csv&quot;, col_types = cols( npdes_id = col_character(), date = col_date(format = &quot;&quot;), mgd = col_double(), cfs = col_double())) wwtf %&gt;% ggplot() + geom_step(aes(date, cfs, color = npdes_id)) + scale_x_date(date_breaks = &quot;month&quot;, date_labels = &quot;%b-%y&quot;) + scale_color_discrete(labels = c(&quot;WQ0010426002, Still Creek WWTF&quot;, &quot;WQ0003821000, Sanderson Farm Inc.&quot; )) + labs(x = &quot;Date&quot;, y = &quot;Mean Daily Discharge [cfs]&quot;) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.line.x = element_blank(), axis.ticks.y = element_line(color = &quot;black&quot;), axis.ticks.x = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), legend.title = element_blank(), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank()) Figure 3: Mean daily WWTF discharges Daily flow estimation Mean daily streamflows from 2020-03-03 through 2021-01-14 were estimated using rating curves at SWQM stations 16396, 16397, and 16882 (Table 1). Mean daily wastewater discharges were subtracted from the flow record to represent naturalized flows. Mean daily temperature and total daily precipitation were joined to the data record by date. Figure 4 shows the hydrograph of naturalized flows and precipitation at each SWQM station. Daily naturalized flow was estimated using the drainage area ratio equation (Equation (1)) at USGS stream gages 08065800, 08109800, and 08110100 (Table 1). Values of recommended in Asquith, Roussel, and Vrabel (2006) were used. Linear regression was also used to estimate log transformed flows at each SWQM station using mean daily flows and 1-day lagged mean daily flows from each USGS stream gage as a predictor variable. dar_table &lt;- tibble(Site = c(&quot;SWQM-16396&quot;, &quot;SWQM-16397&quot;, &quot;SWQM-16882&quot;, &quot;USGS-08065800&quot;, &quot;USGS-08109800&quot;, &quot;USGS-08110100&quot;), Description = c(&quot;Thompsons Creek at Silver Hill Rd&quot;, &quot;Thompsons Creek at Hwy 21&quot;, &quot;Still Creek at Hwy 21&quot;, &quot;Bedias Creek near Madisonville&quot;, &quot;East Yegua Creek near Dime Box&quot;, &quot;Davidson Creek near Lyons&quot;), Area = c(42.33,24.21,10.03,321,244,195)) kable(dar_table, caption = &quot;TCEQ SWQM stations and USGS stream gages used to develop flows with drainage area ratio and linear regression methods.&quot;) Table 1: TCEQ SWQM stations and USGS stream gages used to develop flows with drainage area ratio and linear regression methods. Site Description Area SWQM-16396 Thompsons Creek at Silver Hill Rd 42.33 SWQM-16397 Thompsons Creek at Hwy 21 24.21 SWQM-16882 Still Creek at Hwy 21 10.03 USGS-08065800 Bedias Creek near Madisonville 321.00 USGS-08109800 East Yegua Creek near Dime Box 244.00 USGS-08110100 Davidson Creek near Lyons 195.00 ##naturalize streamflows df &lt;- read_csv(&quot;Data/daily_streamflow/model_df.csv&quot;, col_types = cols( Site = col_character(), date = col_date(format = &quot;&quot;), mean_daily = col_double() )) df %&gt;% bind_rows(tibble(Site = c(rep(&quot;16396&quot;,5),rep(&quot;16397&quot;,5),rep(&quot;16882&quot;,5)), date = rep(seq.Date(as.Date(&quot;2020-02-27&quot;), as.Date(&quot;2020-03-02&quot;), by = &quot;day&quot;),3), mean_daily = NA)) %&gt;% arrange(date) %&gt;% left_join(easterwood_precip, by = c(&quot;date&quot; = &quot;date&quot;)) %&gt;% mutate(value = as.numeric(value)) %&gt;% dplyr::rename(ewood_precip = value) %&gt;% left_join(easterwood_temps, by = c(&quot;date&quot; = &quot;date&quot;)) %&gt;% dplyr::select(Site, date, mean_daily, ewood_precip, tmax, tavg) %&gt;% left_join(wwtf %&gt;% pivot_wider(id_cols = date, names_from = npdes_id, values_from = cfs), by = c(&quot;date&quot; = &quot;date&quot;)) %&gt;% ## remove WWTF influence from discharge record mutate(adjusted_flow = case_when( Site == 16396 ~ mean_daily - TX0025071 - TX0113603, Site == 16882 ~ mean_daily - TX0025071, Site == 16397 ~ mean_daily)) %&gt;% mutate(adjusted_flow = case_when( adjusted_flow &lt; 0 ~ 0, adjusted_flow &gt;= 0 ~ adjusted_flow)) %&gt;% mutate(doy = lubridate::yday(date))-&gt; df ## plot hydrograph of Thompsons @ Silver Hill p1 &lt;- ggplot(df %&gt;% filter(Site == &quot;16396&quot;) %&gt;% mutate(date = as.Date(date))) + geom_line(aes(date, adjusted_flow, color = &quot;Mean Daily Streamflow&quot;)) + scale_y_continuous(position = &quot;left&quot;, limits = c(0,600), expand = c(0,0)) + scale_x_date(date_breaks = &quot;month&quot;, date_labels = &quot;%b-%y&quot;) + labs(y = &quot;Mean daily streamflow [cfs]&quot;, x = &quot;Date&quot;, caption = &quot;16396, Thompsons Creek at Silver Hill Rd&quot;) + scale_color_manual(values = c(&quot;dodgerblue&quot;)) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.text.x = element_text(size = 8), axis.title.y.left = element_text(hjust = 0), axis.ticks.y.left = element_line(color = &quot;black&quot;), axis.ticks.x = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), legend.position = &quot;none&quot;) p2 &lt;- ggplot(df %&gt;% filter(Site == &quot;16396&quot;)) + geom_line(aes(date, ewood_precip, color = &quot;Total Daily Preciptitation&quot;)) + scale_y_reverse(position = &quot;right&quot;, limits = c(350,0), breaks = c(0,25,50), labels = c(0,25,50), expand = c(0,0)) + labs(y = &quot;Total Daily Precipitaiton [mm]&quot;) + scale_color_manual(values = c(&quot;dodgerblue4&quot;)) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.line.x = element_blank(), axis.text.x = element_blank(), axis.title.y.right = element_text(hjust = 1), axis.title.x = element_blank(), axis.ticks.y.right = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), legend.position = &quot;none&quot; ) set_null_device(&quot;agg&quot;) aligned_plots &lt;- align_plots(p1, p2, align=&quot;hv&quot;, axis=&quot;tblr&quot;) set_null_device(&quot;agg&quot;) hg_plot1 &lt;- ggdraw(aligned_plots[[1]]) + draw_plot(aligned_plots[[2]]) ## plot hydrograph of Thompsons @ Hwy21 p1 &lt;- ggplot(df %&gt;% filter(Site == &quot;16397&quot;) %&gt;% mutate(date = as.Date(date))) + geom_line(aes(date, adjusted_flow, color = &quot;Mean Daily Streamflow&quot;)) + scale_y_continuous(position = &quot;left&quot;, limits = c(0,75), expand = c(0,0)) + scale_x_date(date_breaks = &quot;month&quot;, date_labels = &quot;%b-%y&quot;) + labs(y = &quot;Mean daily streamflow [cfs]&quot;, x = &quot;Date&quot;, caption = &quot;16397, Thompsons Creek at Hwy 21&quot;) + scale_color_manual(values = c(&quot;dodgerblue&quot;)) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.text.x = element_text(size = 8), axis.title.y.left = element_text(hjust = 0), axis.ticks.y.left = element_line(color = &quot;black&quot;), axis.ticks.x = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), legend.position = &quot;none&quot;) p2 &lt;- ggplot(df %&gt;% filter(Site == &quot;16397&quot;)) + geom_line(aes(date, ewood_precip, color = &quot;Total Daily Preciptitation&quot;)) + scale_y_reverse(position = &quot;right&quot;, limits = c(350,0), breaks = c(0,25,50), labels = c(0,25,50), expand = c(0,0)) + labs(y = &quot;Total Daily Precipitaiton [mm]&quot;) + scale_color_manual(values = c(&quot;dodgerblue4&quot;)) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.line.x = element_blank(), axis.text.x = element_blank(), axis.title.y.right = element_text(hjust = 1), axis.title.x = element_blank(), axis.ticks.y.right = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), legend.position = &quot;none&quot; ) set_null_device(&quot;agg&quot;) aligned_plots &lt;- align_plots(p1, p2, align=&quot;hv&quot;, axis=&quot;tblr&quot;) set_null_device(&quot;agg&quot;) hg_plot2 &lt;- ggdraw(aligned_plots[[1]]) + draw_plot(aligned_plots[[2]]) ## plot hydrograph of Sill Creek @ Hwy21 p1 &lt;- ggplot(df %&gt;% filter(Site == &quot;16882&quot;) %&gt;% mutate(date = as.Date(date))) + geom_line(aes(date, adjusted_flow, color = &quot;Mean Daily Streamflow&quot;)) + scale_y_continuous(position = &quot;left&quot;, limits = c(0,75), expand = c(0,0)) + scale_x_date(date_breaks = &quot;month&quot;, date_labels = &quot;%b-%y&quot;) + labs(y = &quot;Mean daily streamflow [cfs]&quot;, x = &quot;Date&quot;, caption = &quot;16882, Sill Creek at Hwy 21&quot;) + scale_color_manual(values = c(&quot;dodgerblue&quot;)) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.text.x = element_text(size = 8), axis.title.y.left = element_text(hjust = 0), axis.ticks.y.left = element_line(color = &quot;black&quot;), axis.ticks.x = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), legend.position = &quot;none&quot;) p2 &lt;- ggplot(df %&gt;% filter(Site == &quot;16882&quot;)) + geom_line(aes(date, ewood_precip, color = &quot;Total Daily Preciptitation&quot;)) + scale_y_reverse(position = &quot;right&quot;, limits = c(350,0), breaks = c(0,25,50), labels = c(0,25,50), expand = c(0,0)) + labs(y = &quot;Total Daily Precipitaiton [mm]&quot;) + scale_color_manual(values = c(&quot;dodgerblue4&quot;)) + theme_ms() + guides(x = guide_axis(angle = 90)) + theme(axis.line.x = element_blank(), axis.text.x = element_blank(), axis.title.y.right = element_text(hjust = 1), axis.title.x = element_blank(), axis.ticks.y.right = element_line(color = &quot;black&quot;), axis.ticks.length = grid::unit(5, &quot;pt&quot;), panel.grid.major.x = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.minor.y = element_blank(), legend.position = &quot;none&quot; ) set_null_device(&quot;agg&quot;) aligned_plots &lt;- align_plots(p1, p2, align=&quot;hv&quot;, axis=&quot;tblr&quot;) set_null_device(&quot;agg&quot;) hg_plot3 &lt;- ggdraw(aligned_plots[[1]]) + draw_plot(aligned_plots[[2]]) hg_plot1 / hg_plot2 / hg_plot3 Figure 4: Hydrograph of mean daily streamflows at SWQM 16396, 16397, and 16882 with reported total daily precipitation at Easterwood Airport. GLMs and GAMs relied on local precipitation and temperature data to estimate streamflows at each SWQM station (Figure 1; Figure 2). The GLM was of form: \\[\\begin{equation} Q = P + T + DOY + P_{sum,3} + T_{mean,5} + (P\\times T) + (P \\times P_{sum,3}) + (P \\times T_{mean,5}) + (T \\times P_{sum,3}) + (T \\times T_{mean,5}) + (P_{sum,3} \\times T_{mean,5}) \\tag{5} \\end{equation}\\] where \\(P\\) is total daily precipitation and \\(T\\) is mean daily temperature, and are assumed to be the main forcing variables influencing streamflow. \\(DOY\\) is day of the year and included as a seasonal predictor. \\(P_{sum,3}\\) is the rolling 3-day sum rainfall and included as an indicator of wetness in the watershed. \\(T_{mean,5}\\) is the rolling 5-day mean temperature and included as an indicator of seasonal temperature condition that is less daily variance than \\(T\\) and maybe an improved indicator of potential evapotransportation conditions. The GLM error structure was fit with a scaled t distribution and a log link function. The GAM included the same variables but with smoothing functions: \\[\\begin{equation} Q = f(P) + f(T) + f(DOY) + f(P_{sum,3}) + f(T_{mean,5}) + f(P,T) + f(P, P_{sum,3}) + f(P,T_{mean,5}) + f(T,P_{sum,3}) + (T,T_{mean,5}) + f(P_{sum,3},T_{mean,5}) \\tag{6} \\end{equation}\\] where \\(f()\\) is the smoothing function. Where a single covariate is smoothed, a thin plate regression spline was fit to the data using restricted maximum likelihood to estimated the automatically select the optimal smoothing parameters. For smoothing functions applied to two parameters, a tensor product smooth function was applied. The GAM error structure was fit using the scaled t distribution and a log link function. Performance of predicted streamflows over the period of record for each method was assessed using Nash-Sutcliffe Efficiency (NSE) and Kling-Gupta Efficiency (KGE) goodness-of-fit metrics. Results ## create a model df for 16396 ## additional variable = ## wetness index = 3 day total precip ## ET index = 5 day avg tmax df %&gt;% dplyr::filter(Site == &quot;16396&quot;) %&gt;% arrange(date) -&gt; df_16396 df_16396 %&gt;% mutate(wetness = map(row_number(.$date), ~{if(.x - 1 &lt;= 0) {df_16396$ewood_precip[.x]} if(.x - 2 &lt;= 0) {sum(df_16396$ewood_precip[.x], df_16396$ewood_precip[.x-1])} if(.x - 2 &gt; 0) { sum( df_16396$ewood_precip[.x], df_16396$ewood_precip[.x-1], df_16396$ewood_precip[.x-2], na.rm = TRUE ) }}), et = map(row_number(.$date), ~{if(.x - 1 &lt;= 0) {df_16396$tavg[.x]} if(.x - 2 &lt;= 0) {df_16396$tavg[.x-1]} if(.x - 3 &lt;= 0) { mean(c(df_16396$tavg[.x-1], df_16396$tavg[.x-2]), na.rm = TRUE)} if(.x - 4 &lt;= 0) { mean(c(df_16396$tavg[.x-1], df_16396$tavg[.x-2], df_16396$tavg[.x-3]), na.rm = TRUE)} if(.x - 5 &lt;= 0) { mean(c(df_16396$tavg[.x-1], df_16396$tavg[.x-2], df_16396$tavg[.x-3], df_16396$tavg[.x-4]), na.rm = TRUE)} mean(c(df_16396$tavg[.x-1], df_16396$tavg[.x-2], df_16396$tavg[.x-3], df_16396$tavg[.x-4], df_16396$tavg[.x-5]), na.rm = TRUE)})) %&gt;% unnest(c(wetness, et)) %&gt;% dplyr::filter(!is.na(mean_daily)) -&gt; df_16396 Statistical Information Transfer DAR Mean daily streamflows estimated using DAR applied to three different USGS streamgages are displayed in Figure @ref[fig:dar16396results]. All three USGS gages results in biased results at low streamflows (consistently underpredicted streamflows). The hydrographs indicate the timing and magnitude of stormflow events are routinely mismatched using any of the three USGS gages. This visual validation suggests DAR method is not suitable in the Thompsons Creek watershed. ## apply DAR to 16396 using each select USGS gage usgs_08065800 &lt;- readr::read_csv(&quot;Data/USGS_Streamflow/08065800.csv&quot;) %&gt;% dplyr::rename(Flow_08065800 = &quot;133946_00060_00003&quot;) %&gt;% dplyr::select(datetime, Flow_08065800) usgs_08109800 &lt;- readr::read_csv(&quot;Data/USGS_Streamflow/08109800.csv&quot;) %&gt;% dplyr::rename(Flow_08109800 = `135356_00060_00003`) %&gt;% dplyr::select(datetime, Flow_08109800) usgs_08110100 &lt;- readr::read_csv(&quot;Data/USGS_Streamflow/08110100.csv&quot;) %&gt;% dplyr::rename(Flow_08110100 = `135389_00060_00003`) %&gt;% dplyr::select(datetime, Flow_08110100) df_16396 %&gt;% dplyr::select(Site, date, adjusted_flow) %&gt;% left_join(usgs_08065800, by = c(&quot;date&quot; = &quot;datetime&quot;)) %&gt;% dartx(Flow_08065800, 42.33/321) %&gt;% dplyr::rename(DAR_Q_08065800 = Q, Q_percentile_08065800 = Q_percentile, exp_08065800 = exp) %&gt;% left_join(usgs_08109800, by = c(&quot;date&quot; = &quot;datetime&quot;)) %&gt;% dartx(Flow_08109800, 42.33/244) %&gt;% dplyr::rename(DAR_Q_08109800 = Q, Q_percentile_08109800 = Q_percentile, exp_08109800 = exp) %&gt;% left_join(usgs_08110100, by = c(&quot;date&quot; = &quot;datetime&quot;)) %&gt;% dartx(Flow_08110100, 42.33/195) %&gt;% dplyr::rename(DAR_Q_08110100 = Q, Q_percentile_08110100 = Q_percentile, exp_08110100 = exp) -&gt; dar_results_16396 dar_results_16396 %&gt;% dplyr::select(Site, date, adjusted_flow, DAR_Q_08065800, DAR_Q_08109800, DAR_Q_08110100) %&gt;% pivot_longer(c(DAR_Q_08065800, DAR_Q_08109800, DAR_Q_08110100), names_to = &quot;Source_Site&quot;, values_to = &quot;Estimated_Flow&quot;) %&gt;% mutate(Source_Site = case_when( Source_Site == &quot;DAR_Q_08065800&quot; ~ &quot;Estimated flow using USGS-08065800&quot;, Source_Site == &quot;DAR_Q_08109800&quot; ~ &quot;Estimated flow using USGS-08109800&quot;, Source_Site == &quot;DAR_Q_08110100&quot; ~ &quot;Estimated flow using USGS-08110100&quot; )) %&gt;% ggplot() + geom_point(aes(Estimated_Flow, adjusted_flow, color = &quot;DAR Estimates against Naturalized Flow&quot;), alpha = 0.3) + geom_smooth(aes(Estimated_Flow, adjusted_flow, color = &quot;DAR Estimates against Naturalized Flow&quot;), method = &quot;lm&quot;, se = FALSE, alpha = 0.3) + geom_abline(aes(linetype = &quot;1:1 Line&quot;, intercept = 0, slope = 1)) + facet_wrap(~Source_Site, scales = &quot;free&quot;, ncol = 1) + scale_x_continuous(trans = &quot;pseudo_log&quot;) + scale_y_continuous(trans = &quot;pseudo_log&quot;) + labs(x = &quot;DAR Estimated Flow [cfs]&quot;, y = &quot;Naturalized Flow [cfs]&quot;) + guides(color = guide_legend(&quot;&quot;), linetype = guide_legend(&quot;&quot;)) + theme_ms() + theme(legend.margin = margin(0,0,0,0), legend.box = &quot;vertical&quot;, legend.box.margin = margin(0,0,0,0), legend.direction = &quot;vertical&quot;) -&gt; p1 dar_results_16396 %&gt;% dplyr::select(Site, date, DAR_Q_08065800, DAR_Q_08109800, DAR_Q_08110100) %&gt;% pivot_longer(c(DAR_Q_08065800, DAR_Q_08109800, DAR_Q_08110100), names_to = &quot;Source_Site&quot;, values_to = &quot;Estimated_Flow&quot;) %&gt;% mutate(Source_Site = case_when( Source_Site == &quot;DAR_Q_08065800&quot; ~ &quot;Estimated flow using USGS-08065800&quot;, Source_Site == &quot;DAR_Q_08109800&quot; ~ &quot;Estimated flow using USGS-08109800&quot;, Source_Site == &quot;DAR_Q_08110100&quot; ~ &quot;Estimated flow using USGS-08110100&quot; )) %&gt;% ggplot() + geom_line(aes(date, Estimated_Flow, color = &quot;DAR Estimated Flow&quot;)) + geom_line(data = dar_results_16396, aes(date, adjusted_flow, color = &quot;Naturalized Flow SWQM 16396&quot;), alpha = 0.4) + facet_wrap(~Source_Site, scales = &quot;free_y&quot;, ncol = 1) + labs(x = &quot;Date&quot;, y = &quot;Mean Daily Flow [cfs]&quot;) + theme_ms() + theme(legend.title = element_blank(), legend.direction = &quot;vertical&quot;) -&gt; p2 p1 + p2 ## `geom_smooth()` using formula &#39;y ~ x&#39; Figure 5: Estimated streamflows at SWQM 16396 using DAR at three USGS gages plotted against measured streamflows and over time. Linear Regression df_16396 %&gt;% dplyr::select(Site, date, adjusted_flow) %&gt;% left_join(usgs_08065800, by = c(&quot;date&quot; = &quot;datetime&quot;)) %&gt;% left_join(usgs_08109800, by = c(&quot;date&quot; = &quot;datetime&quot;)) %&gt;% left_join(usgs_08110100, by = c(&quot;date&quot; = &quot;datetime&quot;)) %&gt;% mutate(lag_Flow_08065800 = lag(Flow_08065800), lag_Flow_08109800 = lag(Flow_08109800), lag_Flow_08110100 = lag(Flow_08110100), log_Q = log1p(adjusted_flow)) -&gt; df_16396_lm m1.lm &lt;- lm(log_Q ~ Flow_08065800 + Flow_08109800 + Flow_08110100 + lag_Flow_08065800 + lag_Flow_08109800 + lag_Flow_08110100, data = df_16396_lm) tbl_regression(m1.lm, intercept = TRUE, estimate_fun = ~style_sigfig(.x, digits = 3), label = list(Flow_08065800 ~ &quot;Q at 08065800&quot;, Flow_08109800 ~ &quot;Q at 08109800&quot;, Flow_08110100 ~ &quot;Q at 08110100&quot;, lag_Flow_08065800 ~ &quot;1 Day Lagged Q at 08065800&quot;, lag_Flow_08109800 ~ &quot;1 Day Lagged Q at 08109800&quot;, lag_Flow_08110100 ~ &quot;1 Day Lagged Q at 08110100&quot;)) %&gt;% modify_header(update =list( label ~&quot;**Variable**&quot;, estimate ~ &quot;**Coefficient**&quot;)) %&gt;% add_glance_source_note(include = c(r.squared, statistic, df)) %&gt;% modify_caption(&quot;Summary of linear regression model coefficients at SWQM 16396&quot;) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #tojlhmpjdz .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #tojlhmpjdz .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #tojlhmpjdz .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #tojlhmpjdz .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #tojlhmpjdz .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #tojlhmpjdz .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #tojlhmpjdz .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #tojlhmpjdz .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #tojlhmpjdz .gt_column_spanner_outer:first-child { padding-left: 0; } #tojlhmpjdz .gt_column_spanner_outer:last-child { padding-right: 0; } #tojlhmpjdz .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #tojlhmpjdz .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #tojlhmpjdz .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #tojlhmpjdz .gt_from_md > :first-child { margin-top: 0; } #tojlhmpjdz .gt_from_md > :last-child { margin-bottom: 0; } #tojlhmpjdz .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #tojlhmpjdz .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #tojlhmpjdz .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #tojlhmpjdz .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #tojlhmpjdz .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #tojlhmpjdz .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #tojlhmpjdz .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #tojlhmpjdz .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #tojlhmpjdz .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #tojlhmpjdz .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #tojlhmpjdz .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #tojlhmpjdz .gt_sourcenote { font-size: 90%; padding: 4px; } #tojlhmpjdz .gt_left { text-align: left; } #tojlhmpjdz .gt_center { text-align: center; } #tojlhmpjdz .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #tojlhmpjdz .gt_font_normal { font-weight: normal; } #tojlhmpjdz .gt_font_bold { font-weight: bold; } #tojlhmpjdz .gt_font_italic { font-style: italic; } #tojlhmpjdz .gt_super { font-size: 65%; } #tojlhmpjdz .gt_footnote_marks { font-style: italic; font-size: 65%; } Table 2: Summary of linear regression model coefficients at SWQM 16396 Variable Coefficient 95% CI1 p-value (Intercept) 1.83 1.74, 1.91 Q at 08065800 0.000 0.000, 0.000 0.063 Q at 08109800 0.017 0.013, 0.021 Q at 08110100 0.005 0.004, 0.007 1 Day Lagged Q at 08065800 0.000 0.000, 0.000 >0.9 1 Day Lagged Q at 08109800 -0.005 -0.009, -0.001 0.026 1 Day Lagged Q at 08110100 -0.002 -0.003, 0.000 0.037 R² = 0.409; Statistic = 35.0; df = 6.00 1 CI = Confidence Interval df_16396_lm %&gt;% mutate(fits = as.numeric(predict(m1.lm, newdata = .))) %&gt;% mutate(fits = expm1(fits)) %&gt;% ggplot() + geom_point(aes(fits, adjusted_flow, color = &quot;Regression Estimates against Naturalized Flow&quot;), alpha =0.4) + geom_smooth(aes(fits, adjusted_flow, color = &quot;Regression Estimates against Naturalized Flow&quot;), method = &quot;lm&quot;, se = FALSE) + geom_abline(aes(linetype = &quot;1:1 Line&quot;, intercept = 0, slope = 1)) + scale_x_log10() + scale_y_log10() + labs(x = &quot;Regression Estimated Flow [cfs]&quot;, y = &quot;Naturalized Flow [cfs]&quot;) + guides(color = guide_legend(&quot;&quot;), linetype = guide_legend(&quot;&quot;)) + coord_equal() + theme_ms() + theme(legend.margin = margin(0,0,0,0), legend.box = &quot;vertical&quot;, legend.box.margin = margin(0,0,0,0), legend.direction = &quot;vertical&quot;)-&gt; p1 df_16396_lm %&gt;% mutate(fits = as.numeric(predict(m1.lm, newdata = .))) %&gt;% mutate(fits = expm1(fits)) %&gt;% ggplot() + geom_line(aes(date, fits, color = &quot;Linear Regression Estimated Flow&quot;)) + geom_line(aes(date, adjusted_flow, color = &quot;Naturalized Flow SWQM 16396&quot;), alpha = 0.4) + labs(x = &quot;Date&quot;, y = &quot;Mean Daily Flow [cfs]&quot;) + theme_ms() + theme(legend.title = element_blank(), legend.direction = &quot;vertical&quot;) -&gt; p2 p1 + p2 Figure 6: Estimated streamflows at SWQM 16396 using linear regression plotted against measured streamflows and over time. GLM m1.glm &lt;- gam(adjusted_flow ~ ewood_precip + tavg + doy + wetness + et + ewood_precip:tavg + ewood_precip:wetness + ewood_precip:et + tavg:wetness + tavg:et + wetness:et, data = df_16396, family = scat(link = &quot;log&quot;)) tbl_regression(m1.glm, intercept = TRUE, estimate_fun = ~style_sigfig(.x, digits = 3)) html { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif; } #dbknurvzgf .gt_table { display: table; border-collapse: collapse; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A8A8A8; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A8A8A8; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; } #dbknurvzgf .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #dbknurvzgf .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; border-bottom-color: #FFFFFF; border-bottom-width: 0; } #dbknurvzgf .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 0; padding-bottom: 4px; border-top-color: #FFFFFF; border-top-width: 0; } #dbknurvzgf .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #dbknurvzgf .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; } #dbknurvzgf .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; } #dbknurvzgf .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; } #dbknurvzgf .gt_column_spanner_outer:first-child { padding-left: 0; } #dbknurvzgf .gt_column_spanner_outer:last-child { padding-right: 0; } #dbknurvzgf .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; overflow-x: hidden; display: inline-block; width: 100%; } #dbknurvzgf .gt_group_heading { padding: 8px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; } #dbknurvzgf .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; vertical-align: middle; } #dbknurvzgf .gt_from_md > :first-child { margin-top: 0; } #dbknurvzgf .gt_from_md > :last-child { margin-bottom: 0; } #dbknurvzgf .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; } #dbknurvzgf .gt_stub { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 12px; } #dbknurvzgf .gt_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #dbknurvzgf .gt_first_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; } #dbknurvzgf .gt_grand_summary_row { color: #333333; background-color: #FFFFFF; text-transform: inherit; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; } #dbknurvzgf .gt_first_grand_summary_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; border-top-style: double; border-top-width: 6px; border-top-color: #D3D3D3; } #dbknurvzgf .gt_striped { background-color: rgba(128, 128, 128, 0.05); } #dbknurvzgf .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; } #dbknurvzgf .gt_footnotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #dbknurvzgf .gt_footnote { margin: 0px; font-size: 90%; padding: 4px; } #dbknurvzgf .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; } #dbknurvzgf .gt_sourcenote { font-size: 90%; padding: 4px; } #dbknurvzgf .gt_left { text-align: left; } #dbknurvzgf .gt_center { text-align: center; } #dbknurvzgf .gt_right { text-align: right; font-variant-numeric: tabular-nums; } #dbknurvzgf .gt_font_normal { font-weight: normal; } #dbknurvzgf .gt_font_bold { font-weight: bold; } #dbknurvzgf .gt_font_italic { font-style: italic; } #dbknurvzgf .gt_super { font-size: 65%; } #dbknurvzgf .gt_footnote_marks { font-style: italic; font-size: 65%; } Characteristic Beta 95% CI1 p-value (Intercept) 2.50 2.20, 2.79 ewood_precip 0.082 0.072, 0.092 tavg -0.028 -0.047, -0.009 0.004 doy -0.003 -0.003, -0.002 wetness 0.016 0.006, 0.025 0.001 et -0.003 -0.026, 0.020 0.8 ewood_precip * tavg -0.004 -0.005, -0.004 ewood_precip * wetness 0.000 0.000, 0.000 ewood_precip * et 0.001 0.001, 0.002 tavg * wetness 0.001 0.001, 0.002 tavg * et 0.000 0.000, 0.001 0.3 wetness * et -0.001 -0.002, 0.000 0.016 1 CI = Confidence Interval ##get model fits and confidence intervals glm_fam &lt;- family(m1.glm) ilink &lt;- glm_fam$linkinv df_16396 %&gt;% bind_cols( as_tibble(predict(m1.glm, df_16396, se.fit = TRUE)) %&gt;% mutate(response = ilink(fit), upr_ci = ilink(fit + (2*se.fit)), lwr_ci = ilink(fit - (2*se.fit))) %&gt;% dplyr::select(response, upr_ci, lwr_ci) ) -&gt; df_16396_glm df_16396_glm %&gt;% ggplot() + geom_point(aes(response, adjusted_flow, color = &quot;GLM Estimates against Naturalized Flow&quot;), alpha = 0.4) + geom_smooth(aes(response, adjusted_flow, color = &quot;GLM Estimates against Naturalized Flow&quot;), method = &quot;lm&quot;, se = FALSE) + geom_abline(aes(linetype = &quot;1:1 Line&quot;, intercept = 0, slope = 1)) + scale_x_log10() + scale_y_log10() + labs(x = &quot;GLM Estimated Flow [cfs]&quot;, y = &quot;Naturalized Flow [cfs]&quot;) + guides(color = guide_legend(&quot;&quot;), linetype = guide_legend(&quot;&quot;)) + coord_equal() + theme_ms() + theme(legend.margin = margin(0,0,0,0), legend.box = &quot;vertical&quot;, legend.box.margin = margin(0,0,0,0), legend.direction = &quot;vertical&quot;)-&gt; p1 df_16396_glm %&gt;% ggplot() + geom_line(aes(date, response, color = &quot;GLM Estimated Flow&quot;)) + geom_line(aes(date, adjusted_flow, color = &quot;Naturalized Flow SWQM 16396&quot;), alpha = 0.4) + labs(x = &quot;Date&quot;, y = &quot;Mean Daily Flow [cfs]&quot;) + theme_ms() + theme(legend.title = element_blank(), legend.direction = &quot;vertical&quot;) -&gt; p2 p1+p2 Figure 7: GLM estimated streamflows at SWQM 16396 plotted against measured streamflows and over time. GAM # m1.gam &lt;- gam(adjusted_flow ~ # s(ewood_precip, bs = &quot;ts&quot;) + # s(tavg, bs = &quot;ts&quot;) + # s(doy, bs = &quot;cc&quot;) + # s(wetness, bs = &quot;ts&quot;) + # s(et, bs = &quot;ts&quot;) + # te(ewood_precip, tavg) + # te(ewood_precip, wetness) + # te(ewood_precip, et) + # te(tavg, wetness) + # te(tavg, et) + # te(wetness, et), # data = df_16396, # family = scat(link = &quot;log&quot;), # method = &quot;REML&quot;) # flextable::as_flextable(m1.gam) ##get model fits and confidence intervals # gam_fam &lt;- family(m1.gam) # ilink &lt;- gam_fam$linkinv # # df_16396 %&gt;% # bind_cols( # as_tibble(predict(m1.gam, df_16396, se.fit = TRUE)) %&gt;% # mutate(response = ilink(fit), # upr_ci = ilink(fit + (2*se.fit)), # lwr_ci = ilink(fit - (2*se.fit))) %&gt;% # dplyr::select(response, upr_ci, lwr_ci) # ) -&gt; df_16396_gam # # # # # # df_16396_gam %&gt;% # ggplot() + # geom_point(aes(response, adjusted_flow, # color = &quot;GAM Estimates against Naturalized Flow&quot;), # alpha = 0.4) + # geom_smooth(aes(response, adjusted_flow, # color = &quot;GAM Estimates against Naturalized Flow&quot;), # method = &quot;lm&quot;, se = FALSE) + # geom_abline(aes(linetype = &quot;1:1 Line&quot;, intercept = 0, slope = 1)) + # scale_x_log10() + scale_y_log10() + # labs(x = &quot;GAM Estimated Flow [cfs]&quot;, y = &quot;Naturalized Flow [cfs]&quot;) + # guides(color = guide_legend(&quot;&quot;), linetype = guide_legend(&quot;&quot;)) + # coord_equal() + # theme_ms() + # theme(legend.margin = margin(0,0,0,0), # legend.box = &quot;vertical&quot;, # legend.box.margin = margin(0,0,0,0), # legend.direction = &quot;vertical&quot;)-&gt; p1 # # df_16396_gam %&gt;% # ggplot() + # geom_line(aes(date, response, color = &quot;GAM Estimated Flow&quot;)) + # geom_line(aes(date, adjusted_flow, color = &quot;Naturalized Flow SWQM 16396&quot;), # alpha = 0.4) + # labs(x = &quot;Date&quot;, y = &quot;Mean Daily Flow [cfs]&quot;) + # theme_ms() + # theme(legend.title = element_blank(), # legend.direction = &quot;vertical&quot;) -&gt; p2 # # p1+p2 References "]]
